# Arquitectura del Sistema - Mambbu

## ๐๏ธ Diagrama de Arquitectura

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        USUARIO (Cuba)                        โ
โ                    (Dispositivo medio/bajo)                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ HTTPS
                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     NGINX (Opcional)                         โ
โ                   Reverse Proxy + SSL                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   DOCKER CONTAINER                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ            ASTRO SSR SERVER (Node.js 20)             โ  โ
โ  โ                                                       โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ  โ
โ  โ  โ         ASTRO BUILD (dist/)                 โ    โ  โ
โ  โ  โ                                              โ    โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ     โ    โ  โ
โ  โ  โ  โ    HTML      โ    โ     CSS      โ     โ    โ  โ
โ  โ  โ  โ  (Minified)  โ    โ (Lightning)  โ     โ    โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ     โ    โ  โ
โ  โ  โ                                              โ    โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ     โ    โ  โ
โ  โ  โ  โ React Islandsโ    โ   Astro      โ     โ    โ  โ
โ  โ  โ  โ (Hydration)  โ    โ  Components  โ     โ    โ  โ
โ  โ  โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ     โ    โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ  โ
โ  โ                                                       โ  โ
โ  โ  Port: 4321                                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de Renderizado

```
โโโโโโโโโโโโ
โ Usuario  โ
โ Solicita โ
โ  Pรกgina  โ
โโโโโโฌโโโโโโ
     โ
     โ 1. HTTP Request
     โผ
โโโโโโโโโโโโโโโ
โ Astro SSR   โ
โ   Server    โ
โโโโโโฌโโโโโโโโโ
     โ
     โ 2. Server-Side Rendering
     โ
     โโโโโโโบ 3a. Renderiza componentes Astro (estรกticos)
     โ           โโโบ HTML estรกtico
     โ
     โโโโโโโบ 3b. Renderiza React en servidor (islands)
                 โโโบ HTML + placeholder para hidrataciรณn
     โ
     โ 4. Ensambla HTML completo
     โผ
โโโโโโโโโโโโโโโ
โ   HTML      โ
โ Completo +  โ
โ CSS inline  โ
โโโโโโฌโโโโโโโโโ
     โ
     โ 5. Respuesta HTTP
     โผ
โโโโโโโโโโโโ
โ Navegadorโ
โ  Cliente โ
โโโโโโฌโโโโโโ
     โ
     โ 6. Renderiza HTML (inmediato)
     โ
     โ 7. Descarga CSS (si no inline)
     โ
     โ 8. Descarga JS solo de islands
     โ
     โ 9. Hidrata React islands (parcial)
     โ
     โผ
โโโโโโโโโโโโโโโโ
โ    Pรกgina    โ
โ Interactiva  โ
โโโโโโโโโโโโโโโโ
```

## ๐ฆ Estructura de Componentes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BaseLayout.astro                     โ
โ  (Layout principal - HTML structure)                   โ
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ            Header.astro (Estรกtico)             โ   โ
โ  โ  - Logo                                        โ   โ
โ  โ  - Navegaciรณn                                  โ   โ
โ  โ  - User menu                                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              <slot /> (Contenido)              โ   โ
โ  โ                                                 โ   โ
โ  โ  PรGINA: index.astro                           โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ  โ         Hero Section                     โ โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ   โ
โ  โ  โ  โ    SearchBox.tsx (React Island)    โ โ โ   โ
โ  โ  โ  โ    client:load                     โ โ โ   โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ                                                 โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ  โ     Featured Properties Grid             โ โ   โ
โ  โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ   โ โ   โ
โ  โ  โ  โProperty โ โProperty โ โProperty โ   โ โ   โ
โ  โ  โ  โCard.astroโCard.astroโCard.astroโ   โ โ   โ
โ  โ  โ  โ(Estรกtico)โ(Estรกtico)โ(Estรกtico)โ   โ โ   โ
โ  โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ   โ โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ                                                 โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โ  โ       Stats, About, CTA...               โ โ   โ
โ  โ  โ       (Todo estรกtico Astro)              โ โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ            Footer.astro (Estรกtico)             โ   โ
โ  โ  - Links                                       โ   โ
โ  โ  - Newsletter                                  โ   โ
โ  โ  - Copyright                                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐จ Sistema de Estilos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         TailwindCSS Config              โ
โ  - Colores personalizados               โ
โ  - Fuentes personalizadas               โ
โ  - Breakpoints                          โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          global.css                     โ
โ  @tailwind base;                        โ
โ  @tailwind components;                  โ
โ  @tailwind utilities;                   โ
โ                                          โ
โ  + Custom utilities:                    โ
โ    .tile-pattern                        โ
โ    .postcard-border                     โ
โ    .ticket-cut                          โ
โ    .postal-stamp                        โ
โ    .hero-pattern                        โ
โ    etc...                               โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Lightning CSS (Build time)         โ
โ  - Minificaciรณn                         โ
โ  - Autoprefixer                         โ
โ  - Dead code elimination                โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        CSS Final (~30KB gzipped)        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Proceso de Build

```
โโโโโโโโโโโโโโโโ
โ Source Code  โ
โ    (src/)    โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ    Astro Build Process       โ
โ                              โ
โ  1. Compile .astro files     โ
โ  2. Transpile TypeScript     โ
โ  3. Bundle React components  โ
โ  4. Process Tailwind CSS     โ
โ  5. Optimize images          โ
โ  6. Minify HTML              โ
โ  7. Generate static assets   โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      dist/ (Output)          โ
โ                              โ
โ  โโ server/                  โ
โ  โ  โโ entry.mjs (SSR)      โ
โ  โ                           โ
โ  โโ client/                  โ
โ  โ  โโ chunks/               โ
โ  โ  โ  โโ react-vendor.js   โ
โ  โ  โ  โโ ...               โ
โ  โ  โโ assets/               โ
โ  โ     โโ styles.css        โ
โ  โ     โโ ...               โ
โ  โ                           โ
โ  โโ _astro/                  โ
โ     โโ (hashed assets)       โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ    Docker Container          โ
โ  - Node.js runtime           โ
โ  - Serve dist/server/        โ
โ  - Port 4321                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐พ Flujo de Datos (Futuro)

```
โโโโโโโโโโโโโโโ
โ  PostgreSQL โ
โ  Database   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโ
โ   API Layer     โ
โ  (Node/Express) โ
โโโโโโโโฌโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโ
โ  Astro Server   โ
โ  - Fetch data   โ
โ  - Cache layer  โ
โโโโโโโโฌโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโ
โ   HTML Output   โ
โ  (Con data SSR) โ
โโโโโโโโโโโโโโโโโโโ
```

## ๐ Seguridad

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Frontend                     โ
โ  - Input validation (client-side)        โ
โ  - XSS prevention (React auto-escaping)  โ
โ  - CSRF tokens (forms)                   โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           Astro Server                    โ
โ  - Input sanitization                    โ
โ  - Rate limiting                         โ
โ  - Authentication checks                 โ
โ  - Authorization                         โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            Database                       โ
โ  - Parameterized queries                 โ
โ  - Row-level security                    โ
โ  - Encrypted sensitive fields            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Deployment Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Internet                          โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Load Balancer (Futuro)                โ
โ                    (HTTPS)                         โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
         โ                         โ
         โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ
โ  Docker Host 1   โ      โ  Docker Host 2   โ
โ  โโโโโโโโโโโโโโ  โ      โ  โโโโโโโโโโโโโโ  โ
โ  โ  Mambbu    โ  โ      โ  โ  Mambbu    โ  โ
โ  โ Container  โ  โ      โ  โ Container  โ  โ
โ  โโโโโโโโโโโโโโ  โ      โ  โโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ
```

---

Este diagrama muestra la arquitectura actual del sistema. A medida que el proyecto crezca, se aรฑadirรกn mรกs capas (API, base de datos, cache, etc.).
