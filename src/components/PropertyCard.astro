---
import Icon from './Icon.astro';
import PropertyCardSlider from './PropertyCardSlider';

export interface Props {
  title: string;
  location: string;
  locationDistrict: string;
  address?: string;
  price: string;
  bedrooms: number;
  bathrooms: number;
  area: string;
  image: string;
  images?: Array<{ url: string; alt: string }>;
  featured?: boolean;
  newListing?: boolean;
  verified?: boolean;
  quickResponse?: boolean;
  slug: string;
}

const {
  title,
  location,
  locationDistrict,
  address,
  price,
  bedrooms,
  bathrooms,
  area,
  image,
  images,
  featured = false,
  newListing = false,
  verified = false,
  quickResponse = false,
  slug,
} = Astro.props;

const imageArray = images || [{ url: image, alt: title }];
---

<div class="bg-white postcard-border group flex flex-col h-full relative overflow-hidden">
  <div class="relative h-80 overflow-hidden border-b border-gray-100">
    <PropertyCardSlider images={imageArray} title={title} client:load />

    <!-- overlays: no bloquean el swipe -->
    <div class="absolute top-6 left-6 z-10 flex flex-col gap-2 pointer-events-none">
      {featured && <span class="cuba-badge">★ Anuncio Destacado</span>}
      {verified && (
        <div class="verified-stamp">
          <Icon name="verified" class="text-xs mr-1" size={12} />
          Agencia<br />Verificada
        </div>
      )}
    </div>

    <div class="absolute top-6 right-0 bg-primary text-white py-2 px-6 font-serif italic text-xl ticket-cut shadow-xl z-10 pointer-events-none">
      {price}
    </div>

    <div class="absolute bottom-4 left-4 z-10 flex flex-col gap-2 pointer-events-none">
      {newListing && (
        <span class="bg-sea-glass text-white px-3 py-1 text-[10px] font-bold uppercase tracking-widest">
          Nuevo Ingreso
        </span>
      )}
      {quickResponse && (
        <span class="bg-amber-500 text-white px-3 py-1 text-[10px] font-bold uppercase tracking-widest flex items-center gap-1">
          <Icon name="verified" size={12} />
          Respuesta Rápida
        </span>
      )}
    </div>

    <div class="absolute bottom-4 right-4 z-10 flex gap-2 pointer-events-none">
      <button
        type="button"
        class="pointer-events-auto size-10 bg-white/90 backdrop-blur-sm border border-gray-200 text-primary flex items-center justify-center hover:bg-cuba-red hover:text-white hover:border-cuba-red transition-colors"
      >
        <Icon name="heart" size={20} />
      </button>
    </div>
  </div>

  <div class="p-8 flex flex-col flex-1">
    <h3 class="font-serif font-bold text-2xl italic leading-tight mb-2">{title}</h3>

    <!-- Dirección limpia con icono -->
    <div class="flex items-start gap-2 text-gray-600 text-sm mb-4">
      <Icon name="map-pin" size={16} class="mt-0.5 flex-shrink-0 text-sea-glass" />
      <span class="font-serif italic leading-snug">
        {address || `${location}, ${locationDistrict}`}
      </span>
    </div>

    <div class="mt-auto pt-6 flex items-center justify-between border-t border-gray-50">
      <div class="flex gap-6">
        <div class="text-center">
          <span class="block text-[10px] uppercase font-bold text-gray-400">Hab</span>
          <span class="text-lg font-serif italic">{bedrooms}</span>
        </div>
        <div class="text-center">
          <span class="block text-[10px] uppercase font-bold text-gray-400">Baños</span>
          <span class="text-lg font-serif italic">{bathrooms}</span>
        </div>
        <div class="text-center">
          <span class="block text-[10px] uppercase font-bold text-gray-400">Área</span>
          <span class="text-lg font-serif italic">{area}</span>
        </div>
      </div>

      <a
        href={`/propiedades/${slug}`}
        class="text-sm font-bold uppercase tracking-widest text-sea-glass flex items-center gap-2 hover:translate-x-1 transition-transform"
      >
        Detalles <Icon name="arrow-right" size={14} />
      </a>
    </div>
  </div>
</div>